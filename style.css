// Lightweight interactivity: navigation, reveal, active state, menu toggle
document.addEventListener('DOMContentLoaded', () => {
  const navButtons = Array.from(document.querySelectorAll('.navlink'));
  const sections = Array.from(document.querySelectorAll('.section'));
  const menuToggle = document.getElementById('menuToggle');
  const sidebar = document.getElementById('sidebar');
  const yearEl = document.getElementById('year');

  // set current year
  if (yearEl) yearEl.textContent = new Date().getFullYear();

  // scroll to section when nav clicked
  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.dataset.target;
      const el = document.getElementById(id);
      if (el) {
        el.scrollIntoView({behavior:'smooth',block:'start'});
      }
      // mobile: close sidebar
      if (sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
        menuToggle.setAttribute('aria-expanded','false');
      }
    });
  });

  // toggle sidebar for mobile
  if (menuToggle) {
    menuToggle.addEventListener('click', () => {
      const open = sidebar.classList.toggle('open');
      menuToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
    });
  }

  // IntersectionObserver to show sections and mark active nav item
  const io = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const id = entry.target.id;
      const nav = navButtons.find(b => b.dataset.target === id);
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        nav && nav.classList.add('active');
      } else {
        nav && nav.classList.remove('active');
      }
    });
  }, {root: null, rootMargin: '-20% 0px -40% 0px', threshold: 0});

  sections.forEach(s => io.observe(s));

  // make project cards keyboard accessible (Enter/Space)
  document.querySelectorAll('.proj-card').forEach(card => {
    card.addEventListener('click', () => {
      alert('Project details page coming next â€” you can link this to a project page or modal.');
    });
    card.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        card.click();
      }
    });
  });

  // 3D tilt effect on the hero card
  const cardStage = document.querySelector('.card-stage');
  if (cardStage) {
    cardStage.parentElement.addEventListener('mousemove', (e) => {
      const rect = cardStage.getBoundingClientRect();
      const x = (e.clientX - rect.left) / rect.width - 0.5;
      const y = (e.clientY - rect.top) / rect.height - 0.5;
      cardStage.style.transform = `rotateY(${x * 10}deg) rotateX(${-y * 8}deg)`;
    });
    cardStage.parentElement.addEventListener('mouseleave', () => {
      cardStage.style.transform = '';
    });
  }
});
